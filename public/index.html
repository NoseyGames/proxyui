<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>Asphalt Horizon</title>
    <link rel="shortcut icon" href="favicon.png" />
    
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100;300;400;700;900&display=swap");

        :root {
            --bg-black: #000000;
            --text-white: #ffffff;
            --gray-dim: #222222;
            --gray-med: #666666;
        }

        * { box-sizing: border-box; }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            background-color: var(--bg-black);
            font-family: "Inter", sans-serif;
            color: var(--text-white);
        }

        /* --- BLACK SCREEN OVERLAY --- */
        .splash-overlay {
            position: fixed;
            inset: 0;
            background: black;
            z-index: 999998;
            animation: curtainFade 4.5s ease-in-out both;
            pointer-events: none;
        }

        @keyframes curtainFade {
            0% { opacity: 1; visibility: visible; }
            85% { opacity: 1; }
            100% { opacity: 0; visibility: hidden; }
        }

        /* --- CONSTELLATION CANVAS --- */
        #constellation-canvas {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.5;
        }

        /* --- INTRO TEXT --- */
        body::before {
            content: "ASPHALT HORIZON";
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 15px;
            color: white;
            z-index: 999999;
            pointer-events: none;
            animation: cinematicIntro 4s cubic-bezier(0.2, 0, 0.2, 1) forwards;
        }

        @keyframes cinematicIntro {
            0% { opacity: 0; letter-spacing: 30px; filter: blur(10px); }
            20% { opacity: 1; filter: blur(0px); }
            80% { opacity: 1; letter-spacing: 15px; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.05); visibility: hidden; }
        }

        /* --- MAIN UI --- */
        .centered-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            z-index: 10;
        }

        .logo-wrapper h1 {
            font-size: 5rem;
            font-weight: 900;
            text-transform: uppercase;
            margin-bottom: 40px;
            letter-spacing: -2px;
        }

        .logo-wrapper h1 span {
            font-weight: 100;
            color: var(--gray-med);
            letter-spacing: 5px;
            margin-left: 10px;
        }

        #sj-form { width: 100%; max-width: 580px; padding: 0 20px; }

        #sj-address {
            width: 100%;
            height: 60px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0 30px;
            font-size: 1.1rem;
            outline: none;
            text-align: center;
            font-weight: 300;
        }

        /* --- PROXY FRAME STYLING --- */
        #sj-frame {
            position: fixed;
            inset: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            z-index: 9999999;
            background: #000;
            display: none;
        }

        footer {
            position: absolute;
            bottom: 40px;
            color: var(--gray-med);
            font-size: 0.75rem;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        footer a { color: white; text-decoration: none; margin-left: 15px; opacity: 0.5; }
    </style>

    <script src="/scram/scramjet.all.js" defer></script>
    <script src="/baremux/index.js" defer></script>
    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    </head>
<body>

    <div class="splash-overlay"></div>
    <canvas id="constellation-canvas"></canvas>

    <main class="centered-wrapper" id="main-ui">
        <div class="logo-wrapper">
            <h1>Asphalt<span>Horizon</span></h1>
        </div>

        <form id="sj-form">
            <input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
            <input id="sj-address" type="text" placeholder="Explore the horizon" autofocus autocomplete="off" />
        </form>

        <div class="desc">
            <p id="sj-error"></p>
            <pre id="sj-error-code"></pre>
        </div>

        <footer>
            Horizon Network &copy; 2026 
            <a href="https://securly.pages.dev">Games</a>
        </footer>
    </main>

    <script>
        // --- Constellation Effect ---
        const canvas = document.getElementById('constellation-canvas');
        const ctx = canvas.getContext('2d');
        let points = [];
        const maxDist = 150;
        function initC() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            points = [];
            for (let i = 0; i < 80; i++) {
                points.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, vx: (Math.random()-0.5)*0.3, vy: (Math.random()-0.5)*0.3});
            }
        }
        function drawC() {
            ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle = '#fff';
            points.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy;
                if(p.x<0||p.x>canvas.width) p.vx*=-1; if(p.y<0||p.y>canvas.height) p.vy*=-1;
                ctx.beginPath(); ctx.arc(p.x,p.y,1,0,Math.PI*2); ctx.fill();
                for(let j=i+1; j<points.length; j++){
                    let p2=points[j]; let d=Math.hypot(p.x-p2.x, p.y-p2.y);
                    if(d<maxDist){
                        ctx.beginPath(); ctx.moveTo(p.x,p.y); ctx.lineTo(p2.x,p2.y);
                        ctx.strokeStyle=`rgba(255,255,255,${1-d/maxDist})`; ctx.lineWidth=0.5; ctx.stroke();
                    }
                }
            });
            requestAnimationFrame(drawC);
        }
        window.addEventListener('resize', initC); initC(); drawC();

        // --- Proxy Logic ---
        window.addEventListener('load', () => {
            const form = document.getElementById("sj-form");
            const address = document.getElementById("sj-address");
            const uiWrapper = document.getElementById("main-ui");

            const { ScramjetController } = $scramjetLoadController();
            const scramjet = new ScramjetController({
                files: { wasm: "/scram/scramjet.wasm.wasm", all: "/scram/scramjet.all.js", sync: "/scram/scramjet.sync.js" },
            });
            scramjet.init();

            const connection = new BareMux.BareMuxConnection("/baremux/worker.js");

            async function launchProxy(input) {
                try { await registerSW(); } catch(e) {}
                
                // Using the search function from your search.js
                const url = search(input, document.getElementById("sj-search-engine").value);
                
                let wispUrl = (location.protocol === "https:" ? "wss" : "ws") + "://" + location.host + "/wisp/";
                if (connection && (await connection.getTransport()) !== "/libcurl/index.mjs") {
                    await connection.setTransport("/libcurl/index.mjs", [{ websocket: wispUrl }]);
                }

                if (!window.activeFrame) {
                    const newFrame = scramjet.createFrame();
                    newFrame.frame.id = "sj-frame";
                    document.body.appendChild(newFrame.frame);
                    window.activeFrame = newFrame;
                    
                    // Hide UI so the frame is visible
                    uiWrapper.style.display = "none";
                    canvas.style.display = "none";
                    newFrame.frame.style.display = "block";
                    
                    newFrame.go(url);
                } else {
                    window.activeFrame.go(url);
                }
            }

            form.addEventListener("submit", (e) => {
                e.preventDefault();
                launchProxy(address.value);
            });
        });
    </script>
</body>
</html>
